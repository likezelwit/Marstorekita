<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Top Up Robux - Platform Resmi (Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
      }
      .robux-card {
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .robux-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      .robux-card.selected {
        border: 3px solid #00b4d8;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      }
      .payment-method {
        transition: all 0.3s ease;
      }
      .payment-method:hover {
        background-color: #f3f4f6;
      }
      .payment-method.selected {
        background-color: #dbeafe;
        border-color: #3b82f6;
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }
      .float-animation {
        animation: float 3s ease-in-out infinite;
      }
      .loading-spinner {
        border: 3px solid #f3f4f3;
        border-top: 3px solid #00b4d8;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .bonus-tag {
        position: absolute;
        top: -10px;
        right: -10px;
        background: #ff6b6b;
        color: white;
        font-size: 0.75rem;
        font-weight: bold;
        padding: 3px 8px;
        border-radius: 12px;
        transform: rotate(15deg);
      }
      .info-tooltip {
        position: relative;
        display: inline-block;
        cursor: help;
      }
      .info-tooltip .tooltiptext {
        visibility: hidden;
        width: 250px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 8px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -125px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.75rem;
      }
      .info-tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
      .country-select {
        position: relative;
      }
      .country-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #d1d5db;
        border-top: none;
        border-radius: 0 0 0.5rem 0.5rem;
        max-height: 200px;
        overflow-y: auto;
        z-index: 10;
        display: none;
      }
      .country-dropdown.show {
        display: block;
      }
      .country-option {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        cursor: pointer;
      }
      .country-option:hover {
        background-color: #f3f4f6;
      }
      .success-animation {
        animation: successPulse 0.6s ease-in-out;
      }
      @keyframes successPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }
      .shake {
        animation: shake 0.5s;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-5px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(5px);
        }
      }
      .tab-active {
        border-bottom: 3px solid #00b4d8;
        color: #00b4d8;
      }
      .lazy-load {
        opacity: 0;
        transition: opacity 0.3s;
      }
      .lazy-load.loaded {
        opacity: 1;
      }
      .transaction-history-table {
        width: 100%;
        border-collapse: collapse;
      }
      .transaction-history-table th,
      .transaction-history-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }
      .transaction-history-table th {
        background-color: #f9fafb;
        font-weight: 600;
        color: #374151;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .transaction-history-table tbody tr:hover {
        background-color: #f9fafb;
      }
      .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .status-pending {
        background-color: #fef3c7;
        color: #92400e;
      }
      .status-cek {
        background-color: #dbeafe;
        color: #1e40af;
      }
      .status-proses {
        background-color: #bfdbfe;
        color: #1d4ed8;
      }
      .status-completed {
        background-color: #d1fae5;
        color: #065f46;
      }
      .status-failed {
        background-color: #fee2e2;
        color: #991b1b;
      }

      /* Step Form Styles */
      .step-form {
        position: relative;
      }
      .step-form .step {
        display: none;
      }
      .step-form .step.active {
        display: block;
        animation: fadeIn 0.5s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .step-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
      }
      .step-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
        position: relative;
      }
      .step-indicator::before {
        content: "";
        position: absolute;
        top: 15px;
        left: 0;
        right: 0;
        height: 4px;
        background-color: #e5e7eb;
        z-index: 1;
      }
      .step-indicator .step-dot {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
        position: relative;
      }
      .step-indicator .step-dot.active {
        background-color: #00b4d8;
        color: white;
      }
      .step-indicator .step-dot.completed {
        background-color: #10b981;
        color: white;
      }
      .step-indicator .step-label {
        position: absolute;
        top: 40px;
        transform: translateX(-50%);
        font-size: 0.875rem;
        white-space: nowrap;
      }
      .step-indicator .step-dot.active .step-label {
        color: #00b4d8;
        font-weight: 600;
      }
      .step-indicator .step-dot.completed .step-label {
        color: #10b981;
        font-weight: 600;
      }
      .step-content {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      /* Cooldown Styles */
      .cooldown-timer {
        font-size: 2rem;
        font-weight: bold;
        color: #f59e0b;
      }
      .cooldown-progress {
        height: 8px;
        background-color: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
        margin: 1rem 0;
      }
      .cooldown-progress-bar {
        height: 100%;
        background-color: #f59e0b;
        border-radius: 4px;
        transition: width 1s linear;
      }

      /* Payment Method Logos */
      .payment-logo {
        width: 40px;
        height: 40px;
        object-fit: contain;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <header class="bg-white shadow-sm sticky top-0 z-50">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <div
              class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center"
            >
              <i class="fas fa-gamepad text-white text-xl"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-800">Robux Top Up</h1>
          </div>
          <nav class="hidden md:flex items-center space-x-6">
            <a href="#" class="text-gray-600 hover:text-blue-600 transition"
              >Beranda</a
            >
            <a
              href="#"
              onclick="showHowToTopUp()"
              class="text-gray-600 hover:text-blue-600 transition cursor-pointer"
              >Cara Top Up</a
            >
            <a
              href="#"
              onclick="showHelp()"
              class="text-gray-600 hover:text-blue-600 transition cursor-pointer"
              >Bantuan</a
            >
            <div class="relative">
              <button
                onclick="toggleLanguageDropdown()"
                class="flex items-center text-gray-600 hover:text-blue-600 transition"
              >
                <i class="fas fa-globe mr-1"></i>
                <span id="currentLang">ID</span>
                <i class="fas fa-chevron-down text-xs ml-1"></i>
              </button>
              <div
                id="languageDropdown"
                class="absolute right-0 mt-2 w-32 bg-white rounded-md shadow-lg py-1 z-10 hidden"
              >
                <a
                  href="#"
                  onclick="changeLanguage('id')"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Indonesia</a
                >
                <a
                  href="#"
                  onclick="changeLanguage('en')"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >English</a
                >
              </div>
            </div>
            <button
              class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
            >
              <i class="fas fa-user mr-2"></i>Masuk
            </button>
          </nav>
          <button class="md:hidden text-gray-600" onclick="toggleMobileMenu()">
            <i class="fas fa-bars text-2xl"></i>
          </button>
        </div>
      </div>
    </header>
    <div id="mobileMenu" class="hidden bg-white shadow-lg md:hidden">
      <div class="container mx-auto px-4 py-4 space-y-3">
        <a href="#" class="block text-gray-600 hover:text-blue-600 transition"
          >Beranda</a
        >
        <a
          href="#"
          onclick="showHowToTopUp()"
          class="block text-gray-600 hover:text-blue-600 transition cursor-pointer"
          >Cara Top Up</a
        >
        <a
          href="#"
          onclick="showHelp()"
          class="block text-gray-600 hover:text-blue-600 transition cursor-pointer"
          >Bantuan</a
        >
        <div class="flex items-center justify-between">
          <span class="text-gray-600">Bahasa:</span>
          <select
            onchange="changeLanguage(this.value)"
            class="bg-gray-100 rounded px-2 py-1"
          >
            <option value="id">Indonesia</option>
            <option value="en">English</option>
          </select>
        </div>
        <button
          class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
        >
          <i class="fas fa-user mr-2"></i>Masuk
        </button>
      </div>
    </div>

    <section class="gradient-bg text-white py-16">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h2
            class="text-4xl md:text-5xl font-bold mb-4"
            data-i18n="hero.title"
          >
            Top Up Robux dengan Mudah
          </h2>
          <p class="text-xl mb-8 opacity-90" data-i18n="hero.subtitle">
            Platform resmi untuk pembelian Robux aman dan cepat
          </p>
          <div class="flex justify-center space-x-4">
            <div class="bg-white/20 backdrop-blur-sm rounded-lg px-6 py-3">
              <i class="fas fa-shield-alt mr-2"></i
              ><span data-i18n="hero.secure">100% Aman</span>
            </div>
            <div class="bg-white/20 backdrop-blur-sm rounded-lg px-6 py-3">
              <i class="fas fa-bolt mr-2"></i
              ><span data-i18n="hero.fast">Proses Cepat</span>
            </div>
            <div class="bg-white/20 backdrop-blur-sm rounded-lg px-6 py-3">
              <i class="fas fa-headset mr-2"></i
              ><span data-i18n="hero.support">Support 24/7</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <main class="container mx-auto px-4 py-12">
      <div class="max-w-4xl mx-auto">
        <div class="step-form">
          <div class="step-indicator">
            <div class="step-dot active" id="step1-dot">
              <span>1</span>
              <span class="step-label">Pilih Paket</span>
            </div>
            <div class="step-dot" id="step2-dot">
              <span>2</span>
              <span class="step-label">Data Pengguna</span>
            </div>
            <div class="step-dot" id="step3-dot">
              <span>3</span>
              <span class="step-label">Pembayaran</span>
            </div>
            <div class="step-dot" id="step4-dot">
              <span>4</span>
              <span class="step-label">Proses Pembayaran</span>
            </div>
            <div class="step-dot" id="step5-dot">
              <span>5</span>
              <span class="step-label">Konfirmasi</span>
            </div>
          </div>

          <!-- Step 1: Pilih Paket -->
          <div class="step active" id="step1">
            <div class="step-content">
              <h3
                class="text-2xl font-bold text-gray-800 mb-6"
                data-i18n="package.title"
              >
                Pilih Paket Robux
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div
                  id="pkg1"
                  class="robux-card bg-white border-2 border-gray-200 rounded-xl p-6 relative"
                  onclick="selectPackage(1, '50 Robux', 7200)"
                >
                  <div class="bonus-tag" data-i18n="package.bonus15">
                    Bonus 15%
                  </div>
                  <div class="flex justify-between items-start mb-4">
                    <div>
                      <h4 class="text-xl font-bold text-gray-800">50 Robux</h4>
                      <p class="text-sm text-gray-600" data-i18n="package.mini">
                        Paket Mini
                      </p>
                    </div>
                    <div
                      class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center float-animation"
                    >
                      <i class="fas fa-coins text-green-600 text-xl"></i>
                    </div>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-gray-800"
                      >Rp 7.200</span
                    >
                    <span
                      class="text-sm text-green-600 font-medium"
                      data-i18n="package.save20"
                      >Hemat 20%</span
                    >
                  </div>
                </div>
                <div
                  id="pkg2"
                  class="robux-card bg-white border-2 border-gray-200 rounded-xl p-6 relative"
                  onclick="selectPackage(2, '100 Robux', 14400)"
                >
                  <div class="bonus-tag" data-i18n="package.bonus20">
                    Bonus 20%
                  </div>
                  <div class="flex justify-between items-start mb-4">
                    <div>
                      <h4 class="text-xl font-bold text-gray-800">100 Robux</h4>
                      <p
                        class="text-sm text-gray-600"
                        data-i18n="package.popular"
                      >
                        Paket Popular
                      </p>
                    </div>
                    <div
                      class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center float-animation"
                    >
                      <i class="fas fa-gem text-blue-600 text-xl"></i>
                    </div>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-gray-800"
                      >Rp 14.400</span
                    >
                    <span
                      class="text-sm text-green-600 font-medium"
                      data-i18n="package.save20"
                      >Hemat 20%</span
                    >
                  </div>
                </div>
                <div
                  id="pkg3"
                  class="robux-card bg-white border-2 border-gray-200 rounded-xl p-6 relative"
                  onclick="selectPackage(3, '150 Robux', 21600)"
                >
                  <div class="bonus-tag" data-i18n="package.bonus25">
                    Bonus 25%
                  </div>
                  <div class="flex justify-between items-start mb-4">
                    <div>
                      <h4 class="text-xl font-bold text-gray-800">150 Robux</h4>
                      <p
                        class="text-sm text-gray-600"
                        data-i18n="package.value"
                      >
                        Paket Value
                      </p>
                    </div>
                    <div
                      class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center float-animation"
                    >
                      <i class="fas fa-crown text-purple-600 text-xl"></i>
                    </div>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-gray-800"
                      >Rp 21.600</span
                    >
                    <span
                      class="text-sm text-green-600 font-medium"
                      data-i18n="package.save20"
                      >Hemat 20%</span
                    >
                  </div>
                </div>
                <div
                  id="pkg4"
                  class="robux-card bg-white border-2 border-gray-200 rounded-xl p-6 relative"
                  onclick="selectPackage(4, '200 Robux', 28800)"
                >
                  <div class="bonus-tag" data-i18n="package.bonus30">
                    Bonus 30%
                  </div>
                  <div class="flex justify-between items-start mb-4">
                    <div>
                      <h4 class="text-xl font-bold text-gray-800">200 Robux</h4>
                      <p
                        class="text-sm text-gray-600"
                        data-i18n="package.premium"
                      >
                        Paket Premium
                      </p>
                    </div>
                    <div
                      class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center float-animation"
                    >
                      <i class="fas fa-star text-yellow-600 text-xl"></i>
                    </div>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-gray-800"
                      >Rp 28.800</span
                    >
                    <span
                      class="text-sm text-green-600 font-medium"
                      data-i18n="package.save20"
                      >Hemat 20%</span
                    >
                  </div>
                </div>
              </div>
              <div class="border-t pt-6">
                <h4
                  class="text-lg font-semibold text-gray-800 mb-4"
                  data-i18n="package.customTitle"
                >
                  Atau Masukkan Jumlah Custom (Minimal 50 Robux)
                </h4>
                <div class="relative">
                  <input
                    type="number"
                    id="customAmount"
                    placeholder="Masukkan jumlah Robux"
                    min="50"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    data-i18n-placeholder="package.customPlaceholder"
                  />
                  <div
                    id="customPrice"
                    class="mt-3 text-lg font-medium text-blue-600 hidden"
                  >
                    Harga: <span id="customPriceValue">Rp 0</span>
                  </div>
                  <p id="customError" class="text-red-500 text-xs mt-1 hidden">
                    Minimal 50 Robux.
                  </p>
                </div>
              </div>
            </div>
            <div class="step-navigation">
              <button
                class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition"
                onclick="previousStep()"
                id="prevBtn1"
                style="display: none"
              >
                <i class="fas fa-arrow-left mr-2"></i> Kembali
              </button>
              <button
                class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition ml-auto"
                onclick="nextStep()"
                id="nextBtn1"
                disabled
              >
                Lanjutkan <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>

          <!-- Step 2: Data Pengguna -->
          <div class="step" id="step2">
            <div class="step-content">
              <h3
                class="text-2xl font-bold text-gray-800 mb-6"
                data-i18n="form.title"
              >
                Isi Data Pengguna
              </h3>
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-user mr-2"></i
                  ><span data-i18n="form.username">Username Roblox</span>
                </label>
                <input
                  type="text"
                  id="username"
                  placeholder="Masukkan username Roblox Anda"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  data-i18n-placeholder="form.usernamePlaceholder"
                />
                <p
                  id="usernameError"
                  class="text-red-500 text-xs mt-1 hidden"
                  data-i18n="form.usernameError"
                >
                  Username harus 3-20 karakter dan hanya berisi huruf, angka,
                  dan underscore (_)
                </p>
              </div>
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-phone mr-2"></i
                  ><span data-i18n="form.phone">Nomor HP</span>
                </label>
                <div class="flex">
                  <div class="country-select">
                    <div
                      class="flex items-center justify-center px-4 border border-r-0 border-gray-300 rounded-l-lg bg-gray-50 cursor-pointer"
                      onclick="toggleCountryDropdown()"
                    >
                      <span id="countryFlag" class="mr-2">ðŸ‡®ðŸ‡©</span>
                      <span id="countryCode" class="text-gray-600">+62</span>
                      <i class="fas fa-chevron-down text-gray-600 ml-2"></i>
                    </div>
                    <div id="countryDropdown" class="country-dropdown">
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡®ðŸ‡©', '+62', 'Indonesia')"
                      >
                        <span class="mr-2">ðŸ‡®ðŸ‡©</span>
                        <span>+62</span>
                        <span class="ml-2 text-gray-600">Indonesia</span>
                      </div>
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡²ðŸ‡¾', '+60', 'Malaysia')"
                      >
                        <span class="mr-2">ðŸ‡²ðŸ‡¾</span>
                        <span>+60</span>
                        <span class="ml-2 text-gray-600">Malaysia</span>
                      </div>
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡¸ðŸ‡¬', '+65', 'Singapura')"
                      >
                        <span class="mr-2">ðŸ‡¸ðŸ‡¬</span>
                        <span>+65</span>
                        <span class="ml-2 text-gray-600">Singapura</span>
                      </div>
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡¹ðŸ‡­', '+66', 'Thailand')"
                      >
                        <span class="mr-2">ðŸ‡¹ðŸ‡­</span>
                        <span>+66</span>
                        <span class="ml-2 text-gray-600">Thailand</span>
                      </div>
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡»ðŸ‡³', '+84', 'Vietnam')"
                      >
                        <span class="mr-2">ðŸ‡»ðŸ‡³</span>
                        <span>+84</span>
                        <span class="ml-2 text-gray-600">Vietnam</span>
                      </div>
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡µðŸ‡­', '+63', 'Filipina')"
                      >
                        <span class="mr-2">ðŸ‡µðŸ‡­</span>
                        <span>+63</span>
                        <span class="ml-2 text-gray-600">Filipina</span>
                      </div>
                      <div
                        class="country-option"
                        onclick="selectCountry('ðŸ‡ºðŸ‡¸', '+1', 'Amerika Serikat')"
                      >
                        <span class="mr-2">ðŸ‡ºðŸ‡¸</span>
                        <span>+1</span>
                        <span class="ml-2 text-gray-600">Amerika Serikat</span>
                      </div>
                    </div>
                  </div>
                  <input
                    type="tel"
                    id="phoneNumber"
                    placeholder="81234567890"
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    data-i18n-placeholder="form.phonePlaceholder"
                  />
                </div>
                <p
                  id="phoneError"
                  class="text-red-500 text-xs mt-1 hidden"
                  data-i18n="form.phoneError"
                >
                  Nomor HP tidak valid. Jangan masukkan kode negara di depan.
                </p>
                <p
                  class="text-xs text-gray-500 mt-1"
                  data-i18n="form.phoneNote"
                >
                  Nomor HP Anda akan digunakan untuk konfirmasi pembelian
                </p>
              </div>
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-tag mr-2"></i
                  ><span data-i18n="form.referral"
                    >Kode Referral (Opsional)</span
                  >
                </label>
                <input
                  type="text"
                  id="referralCode"
                  placeholder="Masukkan kode referral"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  data-i18n-placeholder="form.referralPlaceholder"
                />
                <p
                  class="text-xs text-gray-500 mt-1"
                  data-i18n="form.referralNote"
                >
                  Masukkan kode referral untuk mendapatkan bonus tambahan
                </p>
              </div>
            </div>
            <div class="step-navigation">
              <button
                class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition"
                onclick="previousStep()"
                id="prevBtn2"
              >
                <i class="fas fa-arrow-left mr-2"></i> Kembali
              </button>
              <button
                class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition ml-auto"
                onclick="nextStep()"
                id="nextBtn2"
                disabled
              >
                Lanjutkan <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>

          <!-- Step 3: Pembayaran -->
          <div class="step" id="step3">
            <div class="step-content">
              <h3
                class="text-2xl font-bold text-gray-800 mb-6"
                data-i18n="payment.title"
              >
                Metode Pembayaran
              </h3>

              <!-- E-Wallet Section -->
              <div class="payment-category mb-6">
                <h4
                  class="payment-category-title flex items-center text-lg font-semibold text-gray-800 mb-4"
                >
                  <i class="fas fa-wallet mr-2 text-blue-600"></i> E-Wallet
                </h4>
                <div class="payment-grid grid grid-cols-2 md:grid-cols-3 gap-3">
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('gopay')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #00a1de;
                          background-color: rgba(0, 161, 222, 0.1);
                        "
                      >
                        <i class="fas fa-wallet text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">GoPay</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('ovo')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #6b46c1;
                          background-color: rgba(107, 70, 193, 0.1);
                        "
                      >
                        <i class="fas fa-wallet text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">OVO</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('dana')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #0084ff;
                          background-color: rgba(0, 132, 255, 0.1);
                        "
                      >
                        <i class="fas fa-wallet text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">DANA</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('shopeepay')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #ee4d2d;
                          background-color: rgba(238, 77, 45, 0.1);
                        "
                      >
                        <i class="fas fa-wallet text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">
                        ShopeePay
                      </div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('linkaja')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #e51937;
                          background-color: rgba(229, 25, 55, 0.1);
                        "
                      >
                        <i class="fas fa-wallet text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">LinkAja</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('sakuku')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #0060af;
                          background-color: rgba(0, 96, 175, 0.1);
                        "
                      >
                        <i class="fas fa-wallet text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">Sakuku</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Bank Transfer Section -->
              <div class="payment-category mb-6">
                <h4
                  class="payment-category-title flex items-center text-lg font-semibold text-gray-800 mb-4"
                >
                  <i class="fas fa-university mr-2 text-blue-600"></i> Transfer
                  Bank
                </h4>
                <div class="payment-grid grid grid-cols-2 md:grid-cols-3 gap-3">
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('bca')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #0060af;
                          background-color: rgba(0, 96, 175, 0.1);
                        "
                      >
                        <i class="fas fa-university text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">BCA</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('mandiri')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #003d79;
                          background-color: rgba(0, 61, 121, 0.1);
                        "
                      >
                        <i class="fas fa-university text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">Mandiri</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('bni')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #f7941d;
                          background-color: rgba(247, 148, 29, 0.1);
                        "
                      >
                        <i class="fas fa-university text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">BNI</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('bri')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #00529c;
                          background-color: rgba(0, 82, 156, 0.1);
                        "
                      >
                        <i class="fas fa-university text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">BRI</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('cimb')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #ff0000;
                          background-color: rgba(255, 0, 0, 0.1);
                        "
                      >
                        <i class="fas fa-university text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">
                        CIMB Niaga
                      </div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('permata')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #003d79;
                          background-color: rgba(0, 61, 121, 0.1);
                        "
                      >
                        <i class="fas fa-university text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">Permata</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- E-Cards Section -->
              <div class="payment-category mb-6">
                <h4
                  class="payment-category-title flex items-center text-lg font-semibold text-gray-800 mb-4"
                >
                  <i class="fas fa-credit-card mr-2 text-blue-600"></i> Kartu
                  Kredit & Debit
                </h4>
                <div class="payment-grid grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('visa')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #1a1f71;
                          background-color: rgba(26, 31, 113, 0.1);
                        "
                      >
                        <i class="fas fa-credit-card text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">Visa</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('mastercard')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #eb001b;
                          background-color: rgba(235, 0, 27, 0.1);
                        "
                      >
                        <i class="fas fa-credit-card text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">
                        Mastercard
                      </div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('jcb')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #0e4c92;
                          background-color: rgba(14, 76, 146, 0.1);
                        "
                      >
                        <i class="fas fa-credit-card text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">JCB</div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('amex')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #006fcf;
                          background-color: rgba(0, 111, 207, 0.1);
                        "
                      >
                        <i class="fas fa-credit-card text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">
                        American Express
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- QRIS Section -->
              <div class="payment-category mb-6">
                <h4
                  class="payment-category-title flex items-center text-lg font-semibold text-gray-800 mb-4"
                >
                  <i class="fas fa-qrcode mr-2 text-blue-600"></i> QRIS
                </h4>
                <div class="payment-grid grid grid-cols-1 gap-3">
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('qris')"
                  >
                    <div class="flex items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mr-4"
                        style="
                          color: #2e7d32;
                          background-color: rgba(46, 125, 50, 0.1);
                        "
                      >
                        <i class="fas fa-qrcode text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">QRIS</div>
                      <div class="ml-auto text-sm text-gray-500">
                        Semua E-Wallet
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Retail Section -->
              <div class="payment-category mb-6">
                <h4
                  class="payment-category-title flex items-center text-lg font-semibold text-gray-800 mb-4"
                >
                  <i class="fas fa-store mr-2 text-blue-600"></i> Retail
                </h4>
                <div class="payment-grid grid grid-cols-2 gap-3">
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('indomaret')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #ff0000;
                          background-color: rgba(255, 0, 0, 0.1);
                        "
                      >
                        <i class="fas fa-store text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">
                        Indomaret
                      </div>
                    </div>
                  </div>
                  <div
                    class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer"
                    onclick="selectPayment('alfamart')"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="payment-method-icon w-12 h-12 rounded-full flex items-center justify-center mb-2"
                        style="
                          color: #003d79;
                          background-color: rgba(0, 61, 121, 0.1);
                        "
                      >
                        <i class="fas fa-store text-xl"></i>
                      </div>
                      <div class="payment-method-name font-medium">
                        Alfamart
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-6">
                <h4
                  class="text-lg font-semibold text-gray-800 mb-4"
                  data-i18n="summary.title"
                >
                  Ringkasan Pembayaran
                </h4>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600" data-i18n="summary.username"
                      >Username:</span
                    >
                    <span
                      id="displayUsername"
                      class="font-semibold text-gray-800"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600" data-i18n="summary.phone"
                      >Nomor HP:</span
                    >
                    <span id="displayPhone" class="font-semibold text-gray-800"
                      >-</span
                    >
                  </div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600" data-i18n="summary.package"
                      >Paket Terpilih:</span
                    >
                    <span
                      id="selectedPackage"
                      class="font-semibold text-gray-800"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600" data-i18n="summary.robux"
                      >Jumlah Robux:</span
                    >
                    <span
                      id="selectedRobux"
                      class="font-semibold text-green-600"
                      >-</span
                    >
                  </div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 mb-4">
                  <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center">
                      <span
                        class="text-gray-700 font-medium"
                        data-i18n="summary.gamepass"
                        >Gamepass yang harus dibuat:</span
                      >
                      <div class="info-tooltip ml-2">
                        <i class="fas fa-info-circle text-blue-500"></i>
                        <span
                          class="tooltiptext"
                          data-i18n="summary.gamepassTooltip"
                        >
                          Roblox mengambil pajak ~30% dari setiap pembelian.
                          Jumlah ini sudah dihitung agar Anda mendapatkan Robux
                          sesuai yang dibeli.
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="flex justify-between items-center">
                    <span id="gamepassAmount" class="font-bold text-blue-700"
                      >-</span
                    >
                    <span
                      id="robuxAfterTax"
                      class="font-semibold text-green-600"
                    ></span>
                  </div>
                  <div class="mt-2 text-xs text-gray-600">
                    <span id="taxInfo"></span>
                  </div>
                </div>
                <div
                  id="referralBonus"
                  class="bg-green-50 rounded-lg p-4 mb-4 hidden"
                >
                  <div class="flex justify-between items-center">
                    <span
                      class="text-gray-700 font-medium"
                      data-i18n="summary.referralBonus"
                      >Bonus Referral:</span
                    >
                    <span
                      id="referralAmount"
                      class="font-semibold text-green-600"
                      >-</span
                    >
                  </div>
                </div>
                <div class="border-t pt-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600" data-i18n="payment.subtotal"
                      >Subtotal:</span
                    >
                    <span id="subtotal" class="font-medium">Rp 0</span>
                  </div>
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600" data-i18n="payment.adminFee"
                      >Admin Fee:</span
                    >
                    <span class="font-medium">Rp 0</span>
                  </div>
                  <div
                    class="flex justify-between items-center text-lg font-bold"
                  >
                    <span data-i18n="payment.total">Total:</span>
                    <span id="totalPayment" class="text-blue-600">Rp 0</span>
                  </div>
                </div>
              </div>
              <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">
                  <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                  <span data-i18n="payment.secure"
                    >Pembayaran aman dan terenkripsi</span
                  >
                </p>
              </div>
            </div>
            <div class="step-navigation">
              <button
                class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition"
                onclick="previousStep()"
                id="prevBtn3"
              >
                <i class="fas fa-arrow-left mr-2"></i> Kembali
              </button>
              <button
                id="checkoutBtn"
                onclick="processCheckout()"
                disabled
                class="px-6 py-3 bg-gray-400 text-white rounded-lg font-medium transition disabled:cursor-not-allowed ml-auto"
              >
                <i class="fas fa-lock mr-2"></i
                ><span data-i18n="payment.checkout">Lanjutkan Pembayaran</span>
              </button>
            </div>
          </div>

          <!-- Step 4: Proses Pembayaran -->
          <div class="step" id="step4">
            <div class="step-content">
              <h3
                class="text-2xl font-bold text-gray-800 mb-6"
                data-i18n="paymentProcess.title"
              >
                Proses Pembayaran
              </h3>
              <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div id="paymentInstructions" class="mb-6">
                  <!-- Konten instruksi pembayaran akan diisi berdasarkan metode pembayaran -->
                </div>
                <div class="flex justify-center mb-6">
                  <div id="qrisContainer" class="hidden">
                    <div
                      class="bg-gray-100 rounded-lg p-4 flex items-center justify-center"
                    >
                      <div class="bg-white p-2 rounded">
                        <div
                          class="w-48 h-48 bg-gray-200 flex items-center justify-center"
                        >
                          <i class="fas fa-qrcode text-6xl text-gray-400"></i>
                        </div>
                      </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4">
                      Scan QR code di atas untuk membayar
                    </p>
                  </div>
                  <div id="vaContainer" class="hidden w-full">
                    <div class="bg-blue-50 rounded-lg p-6">
                      <h4 class="font-bold text-lg text-blue-800 mb-4">
                        Informasi Virtual Account
                      </h4>
                      <div class="space-y-3">
                        <div
                          class="flex justify-between items-center pb-2 border-b border-blue-100"
                        >
                          <span class="text-gray-600">Bank</span>
                          <span id="vaBank" class="font-semibold">-</span>
                        </div>
                        <div
                          class="flex justify-between items-center pb-2 border-b border-blue-100"
                        >
                          <span class="text-gray-600"
                            >Nomor Virtual Account</span
                          >
                          <span id="vaNumber" class="font-semibold">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                          <span class="text-gray-600">Jumlah</span>
                          <span
                            id="vaAmount"
                            class="font-semibold text-blue-700"
                            >Rp 0</span
                          >
                        </div>
                      </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4">
                      Transfer sesuai jumlah di atas dan konfirmasi pembayaran
                    </p>
                  </div>
                  <div id="ewalletContainer" class="hidden w-full">
                    <div class="bg-purple-50 rounded-lg p-6">
                      <h4 class="font-bold text-lg text-purple-800 mb-4">
                        Informasi E-Wallet
                      </h4>
                      <div class="space-y-3">
                        <div
                          class="flex justify-between items-center pb-2 border-b border-purple-100"
                        >
                          <span class="text-gray-600">E-Wallet</span>
                          <span id="ewalletName" class="font-semibold">-</span>
                        </div>
                        <div
                          class="flex justify-between items-center pb-2 border-b border-purple-100"
                        >
                          <span class="text-gray-600">Nomor E-Wallet</span>
                          <span id="ewalletNumber" class="font-semibold"
                            >-</span
                          >
                        </div>
                        <div class="flex justify-between items-center">
                          <span class="text-gray-600">Jumlah</span>
                          <span
                            id="ewalletAmount"
                            class="font-semibold text-purple-700"
                            >Rp 0</span
                          >
                        </div>
                      </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4">
                      Kirim pembayaran ke nomor di atas sesuai jumlah
                    </p>
                  </div>
                  <div id="retailContainer" class="hidden w-full">
                    <div class="bg-yellow-50 rounded-lg p-6">
                      <h4 class="font-bold text-lg text-yellow-800 mb-4">
                        Informasi Pembayaran Retail
                      </h4>
                      <div class="space-y-3">
                        <div
                          class="flex justify-between items-center pb-2 border-b border-yellow-100"
                        >
                          <span class="text-gray-600">Retail</span>
                          <span id="retailName" class="font-semibold">-</span>
                        </div>
                        <div
                          class="flex justify-between items-center pb-2 border-b border-yellow-100"
                        >
                          <span class="text-gray-600">Kode Pembayaran</span>
                          <span id="retailCode" class="font-semibold">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                          <span class="text-gray-600">Jumlah</span>
                          <span
                            id="retailAmount"
                            class="font-semibold text-yellow-700"
                            >Rp 0</span
                          >
                        </div>
                      </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4">
                      Tunjukkan kode pembayaran ini ke kasir
                    </p>
                  </div>
                  <div id="ccContainer" class="hidden w-full">
                    <div class="bg-indigo-50 rounded-lg p-6">
                      <h4 class="font-bold text-lg text-indigo-800 mb-4">
                        Informasi Kartu Kredit/Debit
                      </h4>
                      <div class="space-y-3">
                        <div
                          class="flex justify-between items-center pb-2 border-b border-indigo-100"
                        >
                          <span class="text-gray-600">Jenis Kartu</span>
                          <span id="ccName" class="font-semibold">-</span>
                        </div>
                        <div
                          class="flex justify-between items-center pb-2 border-b border-indigo-100"
                        >
                          <span class="text-gray-600">Nomor Kartu</span>
                          <span class="font-semibold">**** **** **** ****</span>
                        </div>
                        <div class="flex justify-between items-center">
                          <span class="text-gray-600">Jumlah</span>
                          <span
                            id="ccAmount"
                            class="font-semibold text-indigo-700"
                            >Rp 0</span
                          >
                        </div>
                      </div>
                    </div>
                    <p class="text-center text-gray-600 mt-4">
                      Masukkan informasi kartu Anda dengan aman
                    </p>
                  </div>
                </div>
                <div class="text-center">
                  <p class="text-sm text-gray-600 mb-4">
                    <i class="fas fa-clock text-yellow-500 mr-2"></i>
                    <span data-i18n="paymentProcess.timeout"
                      >Pembayaran akan kadaluarsa dalam 15 menit</span
                    >
                  </p>
                  <button
                    id="confirmPaymentBtn"
                    onclick="confirmPayment()"
                    class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition"
                  >
                    <span data-i18n="paymentProcess.confirm"
                      >Saya Sudah Bayar</span
                    >
                  </button>
                </div>
              </div>
              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                      <span data-i18n="paymentProcess.note"
                        >Pastikan Anda telah melakukan pembayaran sebelum
                        menekan tombol "Saya Sudah Bayar". Pembayaran palsu akan
                        mengakibatkan transaksi dibatalkan.</span
                      >
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="step-navigation">
              <button
                class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition"
                onclick="previousStep()"
                id="prevBtn4"
              >
                <i class="fas fa-arrow-left mr-2"></i> Kembali
              </button>
            </div>
          </div>

          <!-- Step 5: Konfirmasi -->
          <div class="step" id="step5">
            <div class="step-content">
              <div id="loadingContainer" class="text-center py-12">
                <div class="loading-spinner mx-auto mb-6"></div>
                <h3
                  class="text-xl font-bold text-gray-800 mb-2"
                  data-i18n="confirmation.processing"
                >
                  Memproses Pembayaran...
                </h3>
                <p class="text-gray-600" data-i18n="confirmation.pleaseWait">
                  Mohon tunggu sebentar, sistem sedang memverifikasi pembayaran
                  Anda.
                </p>
              </div>
              <div id="successContainer" class="hidden text-center py-12">
                <div
                  class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"
                >
                  <i class="fas fa-check text-green-600 text-4xl"></i>
                </div>
                <h3
                  class="text-2xl font-bold text-gray-800 mb-4"
                  data-i18n="confirmation.success"
                >
                  Pembayaran Berhasil!
                </h3>
                <div class="bg-green-50 rounded-lg p-6 mb-6 max-w-md mx-auto">
                  <p id="successMessage" class="text-gray-700 mb-4">
                    Transaksi berhasil dibuat! ID:
                    <span id="transactionId" class="font-bold">xxxxx</span>.
                    Gamepass yang perlu dibuat:
                    <span id="gamepassAmountSuccess" class="font-bold"
                      >xxx</span
                    >
                    Robux. Silakan lanjutkan ke pembayaran.
                  </p>
                  <div class="flex justify-center mt-4">
                    <div class="bg-white rounded-lg p-3 inline-block">
                      <div class="flex items-center">
                        <div
                          class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2"
                        >
                          <i class="fas fa-gamepad text-blue-600"></i>
                        </div>
                        <div class="text-left">
                          <p class="text-sm font-semibold">Roblox Username</p>
                          <p id="usernameSuccess" class="font-bold">-</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 mb-6">
                  <p class="text-sm text-blue-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    <span data-i18n="confirmation.note"
                      >Robux akan masuk ke akun Anda dalam 1x24 jam. Pastikan
                      Anda telah membuat gamepass dengan harga yang
                      sesuai.</span
                    >
                  </p>
                </div>
                <button
                  onclick="goToHomepage()"
                  class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition"
                >
                  <i class="fas fa-home mr-2"></i
                  ><span data-i18n="confirmation.home">Kembali ke Beranda</span>
                </button>
              </div>
              <div id="cooldownContainer" class="hidden text-center py-12">
                <div
                  class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6"
                >
                  <i class="fas fa-clock text-yellow-600 text-4xl"></i>
                </div>
                <h3
                  class="text-2xl font-bold text-gray-800 mb-4"
                  data-i18n="cooldown.title"
                >
                  Cooldown Period
                </h3>
                <div class="bg-yellow-50 rounded-lg p-6 mb-6 max-w-md mx-auto">
                  <p class="text-gray-700 mb-4" data-i18n="cooldown.message">
                    Anda harus menunggu
                    <span id="cooldownTime" class="font-bold">5:00</span>
                    sebelum dapat melakukan top up lagi.
                  </p>
                  <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                    <div
                      id="cooldownProgress"
                      class="bg-yellow-600 h-2.5 rounded-full"
                      style="width: 0%"
                    ></div>
                  </div>
                  <p class="text-sm text-gray-600" data-i18n="cooldown.note">
                    Ini untuk mencegah transaksi ganda dan memastikan keamanan
                    akun Anda.
                  </p>
                </div>
                <button
                  onclick="goToHomepage()"
                  class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition"
                >
                  <i class="fas fa-home mr-2"></i
                  ><span data-i18n="confirmation.home">Kembali ke Beranda</span>
                </button>
              </div>
            </div>
            <div class="step-navigation">
              <button
                class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition"
                onclick="previousStep()"
                id="prevBtn5"
                style="display: none"
              >
                <i class="fas fa-arrow-left mr-2"></i> Kembali
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <section class="bg-gray-100 py-12 mt-12">
      <div class="container mx-auto px-4">
        <h3
          class="text-3xl font-bold text-center text-gray-800 mb-8"
          data-i18n="features.title"
        >
          Mengapa Memilih Kami?
        </h3>
        <div class="grid md:grid-cols-4 gap-6">
          <div class="text-center">
            <div
              class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-bolt text-blue-600 text-2xl"></i>
            </div>
            <h4
              class="font-semibold text-gray-800 mb-2"
              data-i18n="features.fast"
            >
              Proses Cepat
            </h4>
            <p class="text-sm text-gray-600" data-i18n="features.fastDesc">
              Robux masuk dalam hitungan menit
            </p>
          </div>
          <div class="text-center">
            <div
              class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-check-circle text-green-600 text-2xl"></i>
            </div>
            <h4
              class="font-semibold text-gray-800 mb-2"
              data-i18n="features.legal"
            >
              100% Legal
            </h4>
            <p class="text-sm text-gray-600" data-i18n="features.legalDesc">
              Platform resmi dan terpercaya
            </p>
          </div>
          <div class="text-center">
            <div
              class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-headset text-purple-600 text-2xl"></i>
            </div>
            <h4
              class="font-semibold text-gray-800 mb-2"
              data-i18n="features.support"
            >
              Support 24/7
            </h4>
            <p class="text-sm text-gray-600">
              jika memesan malam lebih dari jam 09.00 akan di proses besok
              11.00-12.00
            </p>
          </div>
          <div class="text-center">
            <div
              class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-gift text-yellow-600 text-2xl"></i>
            </div>
            <h4
              class="font-semibold text-gray-800 mb-2"
              data-i18n="features.bonus"
            >
              Bonus Menarik
            </h4>
            <p class="text-sm text-gray-600" data-i18n="features.bonusDesc">
              Dapatkan bonus setiap pembelian
            </p>
          </div>
        </div>
      </div>
    </section>

    <section class="container mx-auto px-4 py-8">
      <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold text-gray-800" data-i18n="history.title">
            Riwayat Transaksi
          </h3>
          <button
            onclick="refreshTransactionHistory()"
            class="text-blue-600 hover:text-blue-800 transition"
          >
            <i class="fas fa-sync-alt mr-1"></i
            ><span data-i18n="history.refresh">Refresh</span>
          </button>
        </div>
        <div id="transactionHistoryTable" class="overflow-x-auto">
          <table class="transaction-history-table">
            <thead>
              <tr>
                <th data-i18n="history.id">ID Transaksi</th>
                <th data-i18n="history.date">Tanggal</th>
                <th data-i18n="history.robux">Jumlah Robux</th>
                <th data-i18n="history.status">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>#20230901-001</td>
                <td>01 Sep 2023</td>
                <td>100 Robux</td>
                <td>
                  <span class="status-badge status-completed">Completed</span>
                </td>
              </tr>
              <tr>
                <td>#20230901-002</td>
                <td>01 Sep 2023</td>
                <td>50 Robux</td>
                <td>
                  <span class="status-badge status-proses">Processing</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <footer class="bg-gray-800 text-white py-8 mt-12">
      <div class="container mx-auto px-4 text-center">
        <p class="text-sm">
          &copy; 2024 Robux Top Up - Platform Resmi. All rights reserved.
        </p>
      </div>
    </footer>

    <script>
      // =======================================================
      // ADDED: FIREBASE CONFIGURATION (placeholder)
      // SILAHKAN GANTI DENGAN DETAIL FIREBASE ANDA
      // =======================================================
      const firebaseConfig = {
        apiKey: "YOUR_AAIzaSyBP-BfH2y4PnhDR4x0WZceIcu_AA2EKSO4",
        authDomain: "marstorekita-storebase.firebaseapp.com",
        projectId: "marstorekita-storebase",
        storageBucket: "marstorekita-storebase.firebasestorage.app",
        messagingSenderId: "655700298665",
        appId: "Y1:655700298665:web:ae6c703ba545283c2152b8",
      };

      // Inisialisasi Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const TRANSACTIONS_COLLECTION = "transactions";

      // =======================================================
      // CORE LOGIC & VARIABLES
      // =======================================================
      let selectedPackageData = null; // { id: 1, name: '50 Robux', netRobux: 50, price: 7200 }
      let selectedPaymentMethod = null;
      let currentCountryCode = "+62";
      let currentCountryFlag = "ðŸ‡®ðŸ‡©";
      let currentStep = 1;
      let cooldownTimer = null;
      let cooldownEndTime = null;
      let transactionId = null; // Menyimpan ID transaksi dari Firebase

      // =======================================================
      // UTILITY FUNCTIONS
      // =======================================================

      // Fungsi Reverse Calculation (Net Robux -> Gamepass Price)
      function calculateGamepassPrice(netRobux) {
        if (netRobux <= 0) return 0;
        // Formula: Gamepass_Price = ceil(Net_Robux / 0.70)
        // Pembagian 0.70 karena Roblox mengambil 30% pajak.
        return Math.ceil(netRobux / 0.7);
      }

      function formatRupiah(number) {
        if (isNaN(number) || number === null) return "Rp 0";
        return "Rp " + number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }

      function formatRobuxAmount(packageName) {
        return parseInt(packageName.replace(" Robux", "").trim(), 10);
      }

      // Generate ID Transaksi
      function generateTransactionId() {
        const date = new Date();
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        const random = Math.floor(Math.random() * 1000)
          .toString()
          .padStart(3, "0");
        return `#${year}${month}${day}-${random}`;
      }

      // =======================================================
      // STEP FORM FUNCTIONS
      // =======================================================

      function showStep(step) {
        // Hide all steps
        document.querySelectorAll(".step").forEach((el) => {
          el.classList.remove("active");
        });

        // Show current step
        document.getElementById(`step${step}`).classList.add("active");

        // Update step indicators
        document.querySelectorAll(".step-dot").forEach((el, index) => {
          if (index < step) {
            el.classList.add("completed");
            el.classList.remove("active");
          } else if (index === step - 1) {
            el.classList.add("active");
            el.classList.remove("completed");
          } else {
            el.classList.remove("active", "completed");
          }
        });

        // Update navigation buttons
        document.getElementById("prevBtn1").style.display =
          step === 1 ? "none" : "flex";
        document.getElementById("prevBtn2").style.display =
          step === 1 ? "none" : "flex";
        document.getElementById("prevBtn3").style.display =
          step === 1 ? "none" : "flex";
        document.getElementById("prevBtn4").style.display =
          step === 1 ? "none" : "flex";
        document.getElementById("prevBtn5").style.display =
          step === 1 ? "none" : "flex";

        // Update next/checkout button text
        if (step === 3) {
          document.getElementById("nextBtn1").style.display = "none";
          document.getElementById("nextBtn2").style.display = "none";
          document.getElementById("checkoutBtn").style.display = "block";
        } else if (step === 4) {
          document.getElementById("nextBtn1").style.display = "none";
          document.getElementById("nextBtn2").style.display = "none";
          document.getElementById("checkoutBtn").style.display = "none";
          // Tampilkan instruksi pembayaran
          showPaymentInstructions();
        } else if (step === 5) {
          document.getElementById("nextBtn1").style.display = "none";
          document.getElementById("nextBtn2").style.display = "none";
          document.getElementById("checkoutBtn").style.display = "none";
          // Mulai proses konfirmasi
          startConfirmationProcess();
        } else {
          document.getElementById("nextBtn1").style.display = "block";
          document.getElementById("nextBtn2").style.display = "block";
          document.getElementById("checkoutBtn").style.display = "none";
        }

        // Update current step
        currentStep = step;

        // Validate current step
        validateStep(step);
      }

      function nextStep() {
        if (currentStep < 5) {
          showStep(currentStep + 1);
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          showStep(currentStep - 1);
        }
      }

      function validateStep(step) {
        let isValid = false;

        if (step === 1) {
          // Validate package selection
          isValid = selectedPackageData !== null;
          document.getElementById("nextBtn1").disabled = !isValid;
        } else if (step === 2) {
          // Validate user data
          const username = document.getElementById("username").value.trim();
          const phone = document.getElementById("phoneNumber").value.trim();

          const isUsernameValid = username.length >= 3 && username.length <= 20;
          const isPhoneValid = phone.length >= 8;

          isValid = isUsernameValid && isPhoneValid;
          document.getElementById("nextBtn2").disabled = !isValid;

          // Show/hide errors
          document
            .getElementById("usernameError")
            .classList.toggle("hidden", isUsernameValid);
          document
            .getElementById("phoneError")
            .classList.toggle("hidden", isPhoneValid);
        } else if (step === 3) {
          // Validate payment method
          isValid = selectedPaymentMethod !== null;
          document.getElementById("checkoutBtn").disabled = !isValid;

          if (!isValid) {
            document.getElementById("checkoutBtn").classList.add("bg-gray-400");
            document
              .getElementById("checkoutBtn")
              .classList.remove("bg-blue-600", "hover:bg-blue-700");
          } else {
            document
              .getElementById("checkoutBtn")
              .classList.remove("bg-gray-400");
            document
              .getElementById("checkoutBtn")
              .classList.add("bg-blue-600", "hover:bg-blue-700");
          }
        } else if (step === 4) {
          // Step 4 tidak perlu validasi khusus
          isValid = true;
        } else if (step === 5) {
          // Step 5 tidak perlu validasi khusus
          isValid = true;
        }
      }

      // =======================================================
      // UPDATE UI FUNCTIONS
      // =======================================================

      function updateSummary() {
        const username = document.getElementById("username").value.trim();
        const phone = document.getElementById("phoneNumber").value.trim();

        // Update User Info
        document.getElementById("displayUsername").textContent =
          username || "-";
        document.getElementById("displayPhone").textContent =
          currentCountryCode + phone || "-";

        if (!selectedPackageData) {
          document.getElementById("selectedPackage").textContent = "-";
          document.getElementById("selectedRobux").textContent = "-";
          document.getElementById("subtotal").textContent = "Rp 0";
          document.getElementById("totalPayment").textContent = "Rp 0";
          document.getElementById("gamepassAmount").textContent = "-";
          document.getElementById("robuxAfterTax").textContent = "";
          document.getElementById("taxInfo").textContent = "";
          return;
        }

        const netRobux = selectedPackageData.netRobux;
        const price = selectedPackageData.price;
        const grossGamepassPrice = calculateGamepassPrice(netRobux);
        const robuxReceivedBySeller = Math.floor(grossGamepassPrice * 0.7); // Harus sama dengan netRobux

        // Update Selected Package
        document.getElementById("selectedPackage").textContent =
          selectedPackageData.name;
        document.getElementById(
          "selectedRobux"
        ).textContent = `${netRobux} Robux`;

        // Update Payment Totals (assuming admin fee is Rp 0 for now)
        document.getElementById("subtotal").textContent = formatRupiah(price);
        document.getElementById("totalPayment").textContent =
          formatRupiah(price);

        // Update Gamepass Calculator
        document.getElementById(
          "gamepassAmount"
        ).textContent = `${grossGamepassPrice} Robux`;

        // Teks konfirmasi Robux bersih yang akan diterima pengguna
        document.getElementById(
          "robuxAfterTax"
        ).textContent = `(Net: ${netRobux} Robux)`;

        // Teks informasi pajak
        const taxDeducted = grossGamepassPrice - robuxReceivedBySeller;
        const taxRate = ((taxDeducted / grossGamepassPrice) * 100).toFixed(0);
        document.getElementById(
          "taxInfo"
        ).textContent = `Roblox akan memotong ${taxDeducted} Robux (${taxRate}% tax) dari harga ${grossGamepassPrice} Robux.`;

        // Check for validation
        validateStep(currentStep);
      }

      // =======================================================
      // PAYMENT PROCESS FUNCTIONS
      // =======================================================

      function showPaymentInstructions() {
        const instructionsContainer = document.getElementById(
          "paymentInstructions"
        );
        const qrisContainer = document.getElementById("qrisContainer");
        const vaContainer = document.getElementById("vaContainer");
        const ewalletContainer = document.getElementById("ewalletContainer");
        const retailContainer = document.getElementById("retailContainer");
        const ccContainer = document.getElementById("ccContainer");

        // Reset semua kontainer
        qrisContainer.classList.add("hidden");
        vaContainer.classList.add("hidden");
        ewalletContainer.classList.add("hidden");
        retailContainer.classList.add("hidden");
        ccContainer.classList.add("hidden");

        // Update jumlah pembayaran
        const totalAmount = selectedPackageData ? selectedPackageData.price : 0;

        // Tampilkan instruksi berdasarkan metode pembayaran
        if (selectedPaymentMethod === "qris") {
          qrisContainer.classList.remove("hidden");
          instructionsContainer.innerHTML = `
            <h4 class="font-bold text-lg text-gray-800 mb-2">Pembayaran QRIS</h4>
            <p class="text-gray-600 mb-4">Scan kode QR di bawah ini menggunakan aplikasi e-wallet atau mobile banking Anda:</p>
        `;
        } else if (
          ["bca", "mandiri", "bni", "bri", "cimb", "permata"].includes(
            selectedPaymentMethod
          )
        ) {
          vaContainer.classList.remove("hidden");

          // Set bank name based on payment method
          let bankName = "";
          let vaNumber = "";

          switch (selectedPaymentMethod) {
            case "bca":
              bankName = "BCA Virtual Account";
              vaNumber = "8806" + generateRandomNumber(8);
              break;
            case "mandiri":
              bankName = "Mandiri Virtual Account";
              vaNumber = "8923" + generateRandomNumber(10);
              break;
            case "bni":
              bankName = "BNI Virtual Account";
              vaNumber = "8822" + generateRandomNumber(8);
              break;
            case "bri":
              bankName = "BRI Virtual Account";
              vaNumber = "8866" + generateRandomNumber(8);
              break;
            case "cimb":
              bankName = "CIMB Niaga Virtual Account";
              vaNumber = "8840" + generateRandomNumber(8);
              break;
            case "permata":
              bankName = "Permata Virtual Account";
              vaNumber = "8888" + generateRandomNumber(8);
              break;
          }

          document.getElementById("vaBank").textContent = bankName;
          document.getElementById("vaNumber").textContent = vaNumber;
          document.getElementById("vaAmount").textContent =
            formatRupiah(totalAmount);

          instructionsContainer.innerHTML = `
            <h4 class="font-bold text-lg text-gray-800 mb-2">Transfer Bank</h4>
            <p class="text-gray-600 mb-4">Lakukan transfer ke rekening virtual account berikut:</p>
        `;
        } else if (
          ["gopay", "ovo", "dana", "shopeepay", "linkaja", "sakuku"].includes(
            selectedPaymentMethod
          )
        ) {
          ewalletContainer.classList.remove("hidden");

          // Set e-wallet name based on payment method
          let ewalletName = "";
          let ewalletNumber = "";

          switch (selectedPaymentMethod) {
            case "gopay":
              ewalletName = "GoPay";
              ewalletNumber = "0812" + generateRandomNumber(8);
              break;
            case "ovo":
              ewalletName = "OVO";
              ewalletNumber = "0813" + generateRandomNumber(8);
              break;
            case "dana":
              ewalletName = "DANA";
              ewalletNumber = "0857" + generateRandomNumber(8);
              break;
            case "shopeepay":
              ewalletName = "ShopeePay";
              ewalletNumber = "0814" + generateRandomNumber(8);
              break;
            case "linkaja":
              ewalletName = "LinkAja";
              ewalletNumber = "0811" + generateRandomNumber(8);
              break;
            case "sakuku":
              ewalletName = "Sakuku";
              ewalletNumber = "0815" + generateRandomNumber(8);
              break;
          }

          document.getElementById("ewalletName").textContent = ewalletName;
          document.getElementById("ewalletNumber").textContent = ewalletNumber;
          document.getElementById("ewalletAmount").textContent =
            formatRupiah(totalAmount);

          instructionsContainer.innerHTML = `
            <h4 class="font-bold text-lg text-gray-800 mb-2">E-Wallet</h4>
            <p class="text-gray-600 mb-4">Kirim pembayaran ke nomor e-wallet berikut:</p>
        `;
        } else if (
          ["visa", "mastercard", "jcb", "amex"].includes(selectedPaymentMethod)
        ) {
          ccContainer.classList.remove("hidden");

          let cardName = "";
          switch (selectedPaymentMethod) {
            case "visa":
              cardName = "Visa";
              break;
            case "mastercard":
              cardName = "Mastercard";
              break;
            case "jcb":
              cardName = "JCB";
              break;
            case "amex":
              cardName = "American Express";
              break;
          }

          document.getElementById("ccName").textContent = cardName;
          document.getElementById("ccAmount").textContent =
            formatRupiah(totalAmount);

          instructionsContainer.innerHTML = `
            <h4 class="font-bold text-lg text-gray-800 mb-2">Kartu Kredit/Debit</h4>
            <p class="text-gray-600 mb-4">Masukkan informasi kartu Anda untuk melanjutkan pembayaran:</p>
        `;
        } else if (["alfamart", "indomaret"].includes(selectedPaymentMethod)) {
          retailContainer.classList.remove("hidden");

          // Set retail name based on payment method
          let retailName = "";
          let retailCode = "";

          switch (selectedPaymentMethod) {
            case "alfamart":
              retailName = "Alfamart";
              retailCode = "ALF" + generateRandomNumber(8);
              break;
            case "indomaret":
              retailName = "Indomaret";
              retailCode = "IND" + generateRandomNumber(8);
              break;
          }

          document.getElementById("retailName").textContent = retailName;
          document.getElementById("retailCode").textContent = retailCode;
          document.getElementById("retailAmount").textContent =
            formatRupiah(totalAmount);

          instructionsContainer.innerHTML = `
            <h4 class="font-bold text-lg text-gray-800 mb-2">Pembayaran Retail</h4>
            <p class="text-gray-600 mb-4">Tunjukkan kode pembayaran ini ke kasir:</p>
        `;
        }
      }

      // Generate random number with specified length
      function generateRandomNumber(length) {
        let result = "";
        for (let i = 0; i < length; i++) {
          result += Math.floor(Math.random() * 10);
        }
        return result;
      }

      function confirmPayment() {
        // Nonaktifkan tombol untuk mencegah klik ganda
        document.getElementById("confirmPaymentBtn").disabled = true;
        document.getElementById("confirmPaymentBtn").innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i> Memproses...';

        // Simulasikan proses verifikasi pembayaran
        setTimeout(() => {
          nextStep();
        }, 1500);
      }

      function startConfirmationProcess() {
        const loadingContainer = document.getElementById("loadingContainer");
        const successContainer = document.getElementById("successContainer");
        const cooldownContainer = document.getElementById("cooldownContainer");

        // Reset semua kontainer
        loadingContainer.classList.remove("hidden");
        successContainer.classList.add("hidden");
        cooldownContainer.classList.add("hidden");

        // Simulasikan proses loading
        setTimeout(() => {
          loadingContainer.classList.add("hidden");

          // Periksa apakah masih dalam cooldown
          if (isInCooldown()) {
            cooldownContainer.classList.remove("hidden");
            startCooldownTimer();
          } else {
            successContainer.classList.remove("hidden");

            // Update informasi sukses dengan ID transaksi yang benar
            document.getElementById("transactionId").textContent =
              transactionId;
            document.getElementById("usernameSuccess").textContent =
              document.getElementById("username").value;

            if (selectedPackageData) {
              const netRobux = selectedPackageData.netRobux;
              const grossGamepassPrice = calculateGamepassPrice(netRobux);
              document.getElementById("gamepassAmountSuccess").textContent =
                grossGamepassPrice;
            }

            // Simpan waktu transaksi untuk cooldown
            setCooldownTime();
          }
        }, 3000);
      }

      // =======================================================
      // COOLDOWN FUNCTIONS
      // =======================================================

      function isInCooldown() {
        const cooldownTime = localStorage.getItem("robuxTopUpCooldown");
        if (!cooldownTime) return false;

        const cooldownEndTime = parseInt(cooldownTime);
        const currentTime = new Date().getTime();

        return currentTime < cooldownEndTime;
      }

      function setCooldownTime() {
        const cooldownMinutes = 5; // 5 menit cooldown
        const currentTime = new Date().getTime();
        const endTime = currentTime + cooldownMinutes * 60 * 1000;

        localStorage.setItem("robuxTopUpCooldown", endTime.toString());
      }

      function startCooldownTimer() {
        const cooldownTime = localStorage.getItem("robuxTopUpCooldown");
        if (!cooldownTime) return;

        cooldownEndTime = parseInt(cooldownTime);
        updateCooldownDisplay();

        cooldownTimer = setInterval(() => {
          updateCooldownDisplay();

          if (new Date().getTime() >= cooldownEndTime) {
            clearInterval(cooldownTimer);
            document.getElementById("cooldownTime").textContent = "00:00";
            document.getElementById("cooldownProgress").style.width = "100%";
          }
        }, 1000);
      }

      function updateCooldownDisplay() {
        const currentTime = new Date().getTime();
        const remainingTime = Math.max(0, cooldownEndTime - currentTime);

        const minutes = Math.floor(remainingTime / (60 * 1000));
        const seconds = Math.floor((remainingTime % (60 * 1000)) / 1000);

        document.getElementById("cooldownTime").textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

        // Update progress bar
        const totalCooldownTime = 5 * 60 * 1000; // 5 menit dalam milidetik
        const elapsedTime = totalCooldownTime - remainingTime;
        const progress = (elapsedTime / totalCooldownTime) * 100;

        document.getElementById(
          "cooldownProgress"
        ).style.width = `${progress}%`;
      }

      function goToHomepage() {
        window.location.href = "index.html";
      }

      // =======================================================
      // EVENT HANDLERS
      // =======================================================

      function selectPackage(id, name, price) {
        const robuxAmount = formatRobuxAmount(name);
        selectedPackageData = { id, name, netRobux: robuxAmount, price };

        // Remove 'selected' class from all cards
        document.querySelectorAll(".robux-card").forEach((card) => {
          card.classList.remove("selected");
        });

        // Add 'selected' class to the clicked card (by id if present)
        const cardElement =
          document.getElementById("pkg" + id) ||
          document.querySelector(`.robux-card[onclick*='selectPackage(${id}']`);
        if (cardElement) {
          cardElement.classList.add("selected");
        }

        // Hide custom amount details
        // (do NOT overwrite custom input; let user keep typed value)
        document.getElementById("customPrice").classList.add("hidden");

        updateSummary();
      }

      function calculateCustom() {
        const input = document.getElementById("customAmount");
        let robuxAmount = parseInt(input.value, 10);
        const minRobux = 50;
        const pricePerRobux = 144; // Example rate based on 100 Robux @ Rp 14.400

        if (isNaN(robuxAmount) || robuxAmount < minRobux) {
          selectedPackageData = null;
          document.getElementById("customPrice").classList.add("hidden");
          document.getElementById("customError").classList.remove("hidden");
          document
            .querySelectorAll(".robux-card")
            .forEach((card) => card.classList.remove("selected"));
        } else {
          // Calculate price based on the fixed rate for custom packages
          const customPrice = Math.round(robuxAmount * pricePerRobux);
          selectedPackageData = {
            id: 0,
            name: `${robuxAmount} Robux (Custom)`,
            netRobux: robuxAmount,
            price: customPrice,
          };

          // Update custom price display
          document.getElementById("customPriceValue").textContent =
            formatRupiah(customPrice);
          document.getElementById("customPrice").classList.remove("hidden");
          document.getElementById("customError").classList.add("hidden");

          // Remove selection from predefined packages
          document
            .querySelectorAll(".robux-card")
            .forEach((card) => card.classList.remove("selected"));
        }

        updateSummary();
      }

      function selectPayment(method) {
        selectedPaymentMethod = method;

        document.querySelectorAll(".payment-method").forEach((el) => {
          el.classList.remove("selected");
          const check = el.querySelector(".payment-check");
          if (check) check.classList.add("hidden");
        });

        const selectedEl = document.querySelector(
          `.payment-method[onclick*='${method}']`
        );
        if (selectedEl) {
          selectedEl.classList.add("selected");
          const check = selectedEl.querySelector(".payment-check");
          if (check) check.classList.remove("hidden");
        }

        validateStep(3);
      }

      // =======================================================
      // FIREBASE CHECKOUT FUNCTION
      // =======================================================

      async function processCheckout() {
        if (
          !selectedPackageData ||
          !selectedPaymentMethod ||
          document.getElementById("checkoutBtn").disabled
        ) {
          alert("Mohon lengkapi semua data dengan benar.");
          return;
        }

        // Data to be saved
        const username = document.getElementById("username").value.trim();
        const phoneNumber = document.getElementById("phoneNumber").value.trim();
        const referralCode = document
          .getElementById("referralCode")
          .value.trim();

        // Generate transaction ID
        transactionId = generateTransactionId();

        // Reverse calculation data for gamepass creation
        const netRobux = selectedPackageData.netRobux;
        const grossGamepassPrice = calculateGamepassPrice(netRobux);

        const transactionData = {
          transactionId: transactionId,
          username: username,
          fullPhoneNumber: currentCountryCode + phoneNumber,
          referralCode: referralCode || null,
          package: selectedPackageData.name,
          netRobux: netRobux,
          grossGamepassPrice: grossGamepassPrice, // The price user must set for their gamepass
          totalPriceIDR: selectedPackageData.price,
          paymentMethod: selectedPaymentMethod,
          transactionStatus: "Pending", // Initial status
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        };

        document.getElementById("checkoutBtn").disabled = true;
        document.getElementById("checkoutBtn").innerHTML =
          '<i class="loading-spinner mr-2"></i> Memproses...';

        try {
          // Save to Firestore
          const docRef = await db
            .collection(TRANSACTIONS_COLLECTION)
            .add(transactionData);

          // Lanjut ke tahap 4 (Proses Pembayaran)
          nextStep();
        } catch (error) {
          console.error("Error adding document: ", error);
          alert(
            "Terjadi kesalahan saat memproses transaksi. Silakan coba lagi."
          );
          document.getElementById("checkoutBtn").disabled = false;
          document.getElementById("checkoutBtn").innerHTML =
            '<i class="fas fa-lock mr-2"></i>Lanjutkan Pembayaran';
          validateStep(3);
        }
      }

      // =======================================================
      // UI/HELPER FUNCTIONS (Original from user file)
      // =======================================================

      function updateUserInfo() {
        updateSummary();
      }

      function checkReferralBonus() {
        // Mock referral check logic
        const referralCode = document
          .getElementById("referralCode")
          .value.trim();
        const referralBonusDiv = document.getElementById("referralBonus");

        if (referralCode.length > 0) {
          // Mock: Assume valid if not empty
          referralBonusDiv.classList.remove("hidden");
          document.getElementById("referralAmount").textContent = "Rp 1.000";
        } else {
          referralBonusDiv.classList.add("hidden");
        }
      }

      function toggleMobileMenu() {
        document.getElementById("mobileMenu").classList.toggle("hidden");
      }

      function toggleLanguageDropdown() {
        document.getElementById("languageDropdown").classList.toggle("hidden");
      }

      function changeLanguage(lang) {
        document.getElementById("currentLang").textContent = lang.toUpperCase();
        document.getElementById("languageDropdown").classList.add("hidden");
        // Implement actual i18n logic here
        console.log(`Language set to: ${lang}`);
      }

      function toggleCountryDropdown() {
        document.getElementById("countryDropdown").classList.toggle("show");
      }

      function selectCountry(flag, code, name) {
        currentCountryCode = code;
        currentCountryFlag = flag;
        document.getElementById("countryFlag").textContent = flag;
        document.getElementById("countryCode").textContent = code;
        document.getElementById("countryDropdown").classList.remove("show");
        updateUserInfo(); // Trigger summary update
      }

      // =======================================================
      // EVENT LISTENERS (FIXED CUSTOM AMOUNT BEHAVIOR)
      // - Allow user to type freely (only digits), don't force-min during typing
      // - Enforce minimum on blur (when user leaves the field) and on submit
      // =======================================================

      const customInput = document.getElementById("customAmount");
      customInput.addEventListener("input", function (e) {
        // Keep only digits, remove leading zeros while typing, limit length
        let cleaned = e.target.value.replace(/\D/g, "").replace(/^0+/, "");
        if (cleaned.length > 7) cleaned = cleaned.slice(0, 7); // limit to 7 digits
        e.target.value = cleaned;
        // Update custom calculation but DO NOT overwrite user's typing with the minimum yet
        calculateCustom();
      });

      customInput.addEventListener("blur", function (e) {
        // When user leaves the field, enforce minimum
        if (!e.target.value) return;
        const v = parseInt(e.target.value, 10);
        if (isNaN(v) || v < 50) {
          e.target.value = "50";
          calculateCustom();
        }
      });

      // Phone input listener (unchanged logic but safer)
      const phoneInput = document.getElementById("phoneNumber");
      phoneInput.addEventListener("input", function (e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, "");
        if (e.target.value.length > 13) {
          e.target.value = e.target.value.slice(0, 13);
        }
        updateUserInfo();
      });

      document
        .getElementById("username")
        .addEventListener("input", updateUserInfo);
      document
        .getElementById("referralCode")
        .addEventListener("input", function () {
          checkReferralBonus();
          validateStep(2);
        });

      // Close dropdowns when clicking outside
      document.addEventListener("click", function (event) {
        const countrySelect = document.querySelector(".country-select");
        const countryDropdown = document.getElementById("countryDropdown");
        const languageDropdown = document.getElementById("languageDropdown");

        // Close Country Dropdown
        try {
          const countryButton = document.querySelector(".country-select > div");
          if (
            !countrySelect.contains(event.target) &&
            countryButton &&
            !countryButton.contains(event.target)
          ) {
            countryDropdown.classList.remove("show");
          }
        } catch (err) {
          // ignore if elements not present
        }

        // Close Language Dropdown
        const langButton = document.querySelector(".relative button");
        if (
          !event.target.closest("#languageDropdown") &&
          langButton &&
          !langButton.contains(event.target)
        ) {
          languageDropdown.classList.add("hidden");
        }
      });

      // Periksa cooldown saat halaman dimuat
      document.addEventListener("DOMContentLoaded", function () {
        if (isInCooldown()) {
          // Langsung tampilkan halaman cooldown jika masih dalam periode cooldown
          showStep(5);
        } else {
          // Tampilkan step pertama
          showStep(1);
        }
      });

      // Initialize the form
      showStep(1);

      // Mock functions for other non-implemented features
      function showHowToTopUp() {
        alert("Fitur Cara Top Up belum diimplementasikan.");
      }
      function showHelp() {
        alert("Fitur Bantuan belum diimplementasikan.");
      }
      function refreshTransactionHistory() {
        // Refresh transaction history from Firebase
        db.collection(TRANSACTIONS_COLLECTION)
          .orderBy("createdAt", "desc")
          .limit(10)
          .get()
          .then((querySnapshot) => {
            const tableBody = document.querySelector(
              "#transactionHistoryTable tbody"
            );
            tableBody.innerHTML = "";

            querySnapshot.forEach((doc) => {
              const data = doc.data();
              const row = document.createElement("tr");

              // Format date
              let dateStr = "-";
              if (data.createdAt) {
                const date = data.createdAt.toDate();
                dateStr = `${date.getDate().toString().padStart(2, "0")}/${(
                  date.getMonth() + 1
                )
                  .toString()
                  .padStart(2, "0")}/${date.getFullYear()}`;
              }

              // Set status badge class
              let statusClass = "status-pending";
              switch (data.transactionStatus) {
                case "Completed":
                  statusClass = "status-completed";
                  break;
                case "Processing":
                  statusClass = "status-proses";
                  break;
                case "Failed":
                  statusClass = "status-failed";
                  break;
              }

              row.innerHTML = `
                    <td>${data.transactionId || "-"}</td>
                    <td>${dateStr}</td>
                    <td>${data.netRobux} Robux</td>
                    <td><span class="status-badge ${statusClass}">${
                data.transactionStatus || "Pending"
              }</span></td>
                `;

              tableBody.appendChild(row);
            });
          })
          .catch((error) => {
            console.error("Error getting transactions: ", error);
            alert("Gagal memuat riwayat transaksi.");
          });
      }
    </script>
  </body>
</html>
